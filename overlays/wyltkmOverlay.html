<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>WYLTKM Overlay</title>
    <style>
        html, body { margin:0; height:100%; background:transparent; overflow:hidden; }
        :root{
            --col-h: 1080px;
            --box-w: 192px;
            --box-h: 128px;
            --gap:    8px;
            --duration: 20s;
            --right-edge: 25%;
            --top: 0;
            --title-bg: rgba(0,0,0,.45);
            --cyan: #00f0ff;
        }

        #stage { position:relative; width:100%; height:100%; }

        .marquee {
          position:absolute;
          right: var(--right-edge);
          top: var(--top);
          width: var(--box-w);
          height: var(--col-h);
          overflow: hidden;
        }

        .marquee__inner {
          display:flex;
          flex-direction:column;
          gap: var(--gap);
          will-change: transform;
          transform: translate3d(0,0,0);
          backface-visibility: hidden;
          animation: scroll-up var(--duration) linear infinite;
          height: calc(var(--col-h) * 2); /* two tracks stacked */
        }

        .track {
          display:flex;
          flex-direction:column;
          gap: var(--gap);
          height: var(--col-h); /* exactly one column tall */
        }

        .item {
            position:relative;
            width: 100%;
            height: var(--box-h);
            border-radius: 8px;
            overflow: hidden;
            display:flex;
            align-items:center;
            justify-content:center;
            background: #061018;
        }

        .item img {
          max-width:100%;
          max-height:100%;
          width:auto;
          height:auto;
          display:block;
          object-fit: cover;    /*cover = fills and crops; contain = full image, letterboxed */

        }

        .title {
            position:absolute; top:6px; right:6px;
            padding: 2px 6px;
            background: var(--title-bg);
            border: 1px solid rgba(0,240,255,.55);
            border-radius: 6px;
            color: var(--cyan);
            font: 700 11px/1.2 system-ui, Arial, sans-serif;
            letter-spacing: .02em;
            white-space: nowrap;
            pointer-events: none;
            text-shadow: 0 0 .25rem rgba(0,240,255,.35);
        }

        @keyframes scroll-up { to { transform: translate3d(0, -50%, 0); } }

        @media (prefers-reduced-motion: reduce) {
          .marquee__inner { animation: none; }
        }
    </style>
</head>
<body>
<div id="stage">
    <div class="marquee">
        <div class="marquee__inner" id="marqueeInner">
        </div>
    </div>
</div>

<script>
    const inner = document.getElementById('marqueeInner');

    function buildTrack(items) {
        const track = document.createElement('div');
        track.className = 'track';

        const BOXES_PER_TRACK = 8;
        for (let i = 0; i < BOXES_PER_TRACK; i++) {
            const it = items [i % items.length];

            const div = document.createElement('div');
            div.className = 'item';
            div.dataset.id = it.id;

            const img = document.createElement('img');
            img.src = it.src;
            img.alt = it.title;

            const badge = document.createElement('div');
            badge.className = 'title';
            badge.textContent = it.title;

            div.appendChild(img);
            div.appendChild(badge);
            track.appendChild(div);
        }
        return track;
    }

    async function load() {
        let items = [];
        try {
            const resp = await fetch('/overlay/images.json', { cache: 'no-store' });
            const data = await resp.json();
            items = Array.isArray(data.items) ? data.items : [];
            items = items.filter(it => it && it.id && it.title && it.src);
            // console.log('items from server:', items);
        } catch (e) {
            console.error('overlay failed to fetch images.json', e);
        }

        if (items.length === 0) {
            const placeholder = Array.from({ length: 8 }, (_, i) => ({
            id: `placeholder-${i}`,
            title: `PLACEHOLDER ${i+1}`,
            src: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='
            }));
            items = placeholder;
        }

        const trackA = buildTrack(items);
        const trackB = buildTrack(items);

        inner.innerHTML = '';
        inner.appendChild(trackA);
        inner.appendChild(trackB);
    }

    (async function init(){ await load(); })();
</script>
</body>
</html>
